<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
  <meta name="format-detection" content="telephone=no, email=no">
  <meta name="baidu-site-verification" content="1mIt1OtUw3" />

  

  
  <link rel="alternate" href="/atom.xml" title="Rocco&#39;s Blog" type="application/atom+xml">
  

  <!-- 为 IOS 上的 Safari 添加桌面图标 -->
  <meta name="apple-mobile-web-app-title" content="Simple">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="#333">
  <link rel="apple-touch-icon-precomposed" sizes="128x128" href="/images/icons/icon-128.png">

  <!-- 为 Windows 添加磁片图标 -->
  <meta name="msapplication-TileImage" content="/images/icons/icon-128.png">
  <meta name="msapplication-TileColor" content="#ff0000">

  <meta name="baidu-site-verification" content="MHqWnI2vxk">

  
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
  
  <title>服务器配置（Nginx，Node，PM2，HTTPS，HTTP2） | Rocco&#39;s Blog</title>
  <meta name="description" content="JavaScript, ES6, CSS3, 前端笔记">

  <link rel="stylesheet" href="/css/style.css">

  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f5f5f5">
</head>


<body>
  <div class="share-avatar">
    <img class="avatar" src="/images/avatar.jpg" alt="头像">
  </div>

  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner" class="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Rocco&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">简简简简单</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
      </nav>
      <nav id="sub-nav">
        
          <!--<a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>-->
        
        <a id="nav-github-btn" class="nav-icon" title="GitHub" href="https://github.com/zh-rocco" target="_blank" rel="nofollow me noopener noreferrer"></a>
        <!--<a id="nav-search-btn" class="nav-icon" title="搜索"></a>-->
      </nav>
      <!--<div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://zh-rocco.github.io"></form>
      </div>-->
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-a-linux/server" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a-linux/server.html" class="article-date">
  <time datetime="2017-05-22T16:10:00.000Z" itemprop="datePublished">2017-05-23</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>


  </div>
  <div class="article-inner">
    

    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      服务器配置（Nginx，Node，PM2，HTTPS，HTTP2）
    </h1>
  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>环境：腾讯云服务器，64 位 CentOS-7，root 用户</em></p>
<h2 id="连接服务器"><a href="#连接服务器" class="headerlink" title="连接服务器"></a>连接服务器</h2><h3 id="通过-Xshell-连接服务器"><a href="#通过-Xshell-连接服务器" class="headerlink" title="通过 Xshell 连接服务器"></a>通过 Xshell 连接服务器</h3><h4 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h4><p>略</p>
<h4 id="2-新建-SSH-连接"><a href="#2-新建-SSH-连接" class="headerlink" title="2. 新建 SSH 连接"></a>2. 新建 SSH 连接</h4><p><img src="/images/article/xshell-new.jpg" alt="新建 SSH 连接"></p>
<a id="more"></a>
<p><img src="/images/article/xhell-ip.jpg" alt="绑定服务器主机 IP"></p>
<p>输入完成后点击 “确定”;</p>
<p><img src="/images/article/xshell-user.jpg" alt="输入用户名"></p>
<p><img src="/images/article/xshell-password.jpg" alt="输入密码"></p>
<p>点击确定连接。</p>
<p><strong>参考：</strong></p>
<ol>
<li><a href="http://www.yedanbo.com/post/2017/qcloud-deploy-nodejs-application/" target="_blank" rel="noopener">腾讯云服务器部署 Node.js 应用</a></li>
</ol>
<h3 id="打开多个-Shell-界面"><a href="#打开多个-Shell-界面" class="headerlink" title="打开多个 Shell 界面"></a>打开多个 Shell 界面</h3><p>鼠标移到已经连接的服务器 <strong>标签</strong>（标红处）上，点击右键，选择 <strong>复制 SSH 渠道</strong>。</p>
<p><img src="/images/article/xshell-copy-ssh.jpg" alt="Xshell复制SSH渠道"></p>
<h2 id="更新系统和软件包"><a href="#更新系统和软件包" class="headerlink" title="更新系统和软件包"></a>更新系统和软件包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum update</span><br><span class="line">yum upgrade</span><br></pre></td></tr></table></figure>
<h2 id="安装必备软件"><a href="#安装必备软件" class="headerlink" title="安装必备软件"></a>安装必备软件</h2><h3 id="配置编译环境"><a href="#配置编译环境" class="headerlink" title="配置编译环境"></a>配置编译环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 make</span></span><br><span class="line">yum -y install gcc automake autoconf libtool make</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 g++</span></span><br><span class="line">yum -y install gcc gcc-c++</span><br></pre></td></tr></table></figure>
<h3 id="安装-lrzsz（Xshell-环境下用于文件上传和下载）"><a href="#安装-lrzsz（Xshell-环境下用于文件上传和下载）" class="headerlink" title="安装 lrzsz（Xshell 环境下用于文件上传和下载）"></a>安装 lrzsz（Xshell 环境下用于文件上传和下载）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install lrzsz</span><br></pre></td></tr></table></figure>
<h3 id="选择源码安装目录"><a href="#选择源码安装目录" class="headerlink" title="选择源码安装目录"></a>选择源码安装目录</h3><p>可以是任何目录，我选择的是 <code>/usr/local/src</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br></pre></td></tr></table></figure>
<h3 id="更新-安装-OpenSSL"><a href="#更新-安装-OpenSSL" class="headerlink" title="更新/安装 OpenSSL"></a>更新/安装 OpenSSL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看已安装的 SSL 版本</span></span><br><span class="line">openssl version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果显示 openssl 版本低于 1.02，则需要更新（为了后续开启 http2）</span></span><br><span class="line"><span class="comment"># 切换到源码安装目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载源码包</span></span><br><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.0.2l.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -zxvf openssl-1.0.2l.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到源码目录内</span></span><br><span class="line"><span class="built_in">cd</span> openssl-1.0.2l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加配置</span></span><br><span class="line">./config --prefix=/usr/<span class="built_in">local</span>/openssl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存老版本的 openssl</span></span><br><span class="line">mv /usr/bin/openssl /usr/bin/openssl.OFF</span><br><span class="line">mv /usr/include/openssl /usr/include/openssl.OFF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建软链</span></span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/openssl/bin/openssl /usr/bin/openssl</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/openssl/include/openssl /usr/include/openssl</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/usr/local/openssl/lib"</span>&gt;&gt;/etc/ld.so.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否安装成功</span></span><br><span class="line">openssl version</span><br></pre></td></tr></table></figure>
<p><strong>参考：</strong></p>
<ol>
<li><a href="http://blog.csdn.net/l1028386804/article/details/53165252" target="_blank" rel="noopener">CentOS 之——升级 openssl 为最新版</a></li>
</ol>
<h3 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到源码安装目录（如果更换其他目录，下面引用的路径同样需要修改）</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载源码包</span></span><br><span class="line">wget http://nginx.org/download/nginx-1.12.0.tar.gz</span><br><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.0.2l.tar.gz</span><br><span class="line">wget http://zlib.net/zlib-1.2.11.tar.gz</span><br><span class="line">wget https://ftp.pcre.org/pub/pcre/pcre-8.35.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -zxvf nginx-1.12.0.tar.gz</span><br><span class="line">tar -zxvf openssl-1.0.2l.tar.gz</span><br><span class="line">tar -zxvf pcre-8.35.tar.gz</span><br><span class="line">tar -zxvf zlib-1.2.11.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换目录</span></span><br><span class="line"><span class="built_in">cd</span> nginx-1.12.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个 nginx 目录用来存放运行的临时文件夹</span></span><br><span class="line">mkdir -p /var/cache/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加配置</span></span><br><span class="line"><span class="comment"># --prefix=/usr/local/nginx --&gt; 指定安装路径</span></span><br><span class="line"><span class="comment"># --conf-path=/etc/nginx/nginx.conf --&gt; 指定配置文件的位置</span></span><br><span class="line"><span class="comment"># --with-http_ssl_module --&gt; 启用 SSL 模块</span></span><br><span class="line"><span class="comment"># --with-http_v2_module --&gt; 启用 http2 模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 转义符："\" 可以实现在多行输入一句命令</span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx \</span><br><span class="line">            --sbin-path=/usr/sbin/nginx \</span><br><span class="line">            --conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">            --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log \</span><br><span class="line">            --http-log-path=/var/<span class="built_in">log</span>/nginx/access.log \</span><br><span class="line">            --pid-path=/var/run/nginx.pid \</span><br><span class="line">            --lock-path=/var/run/nginx.lock \</span><br><span class="line">            --http-client-body-temp-path=/var/cache/nginx/client_temp \</span><br><span class="line">            --http-proxy-temp-path=/var/cache/nginx/proxy_temp \</span><br><span class="line">            --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</span><br><span class="line">            --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</span><br><span class="line">            --http-scgi-temp-path=/var/cache/nginx/scgi_temp \</span><br><span class="line">            --user=nobody \</span><br><span class="line">            --group=nobody \</span><br><span class="line">            --with-openssl=/usr/<span class="built_in">local</span>/src/openssl-1.0.2l \</span><br><span class="line">            --with-pcre=/usr/<span class="built_in">local</span>/src/pcre-8.35 \</span><br><span class="line">            --with-zlib=/usr/<span class="built_in">local</span>/src/zlib-1.2.11 \</span><br><span class="line">            --with-http_ssl_module \</span><br><span class="line">            --with-http_v2_module \</span><br><span class="line">            --with-http_realip_module \</span><br><span class="line">            --with-http_addition_module \</span><br><span class="line">            --with-http_sub_module \</span><br><span class="line">            --with-http_dav_module \</span><br><span class="line">            --with-http_flv_module \</span><br><span class="line">            --with-http_mp4_module \</span><br><span class="line">            --with-http_gunzip_module \</span><br><span class="line">            --with-http_gzip_static_module \</span><br><span class="line">            --with-http_random_index_module \</span><br><span class="line">            --with-http_secure_link_module \</span><br><span class="line">            --with-http_stub_status_module \</span><br><span class="line">            --with-http_auth_request_module \</span><br><span class="line">            --with-mail \</span><br><span class="line">            --with-mail_ssl_module \</span><br><span class="line">            --with-file-aio \</span><br><span class="line">            --with-ipv6 \</span><br><span class="line">            --with-http_v2_module \</span><br><span class="line">            --with-threads \</span><br><span class="line">            --with-stream \</span><br><span class="line">            --with-stream_ssl_module \</span><br><span class="line">            --with-threads \</span><br><span class="line">            --with-debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新启动 Xshell，或者重启 Shell 窗口 !!!</span></span><br><span class="line"><span class="comment"># 检查是否安装成功</span></span><br><span class="line">nginx -V</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 systemctl 服务</span></span><br><span class="line">vim /usr/lib/systemd/system/nginx.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制代码</span></span><br><span class="line"><span class="comment"># 按 i 输入以下内容</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx - high performance web server</span><br><span class="line">Documentation=http://nginx.org/en/docs/</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/var/run/nginx.pid</span><br><span class="line">ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/nginx.conf</span><br><span class="line">ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/<span class="built_in">kill</span> -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按 Esc 推出 vim 编辑模式，输入 :wq 然后点击 Enter，保存并退出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新启动 Xshell，或者重启 Shell 窗口 !!!</span></span><br><span class="line"><span class="comment"># 重启 nginx</span></span><br><span class="line">systemctl start nginx.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启 nginx</span></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx.service</span><br></pre></td></tr></table></figure>
<p><strong>参考：</strong></p>
<ol>
<li><a href="http://www.cnblogs.com/bugutian/p/6628455.html" target="_blank" rel="noopener">nginx 支持 HTTP2 的配置过程</a></li>
<li><a href="http://blog.csdn.net/vivid_110/article/details/50088349" target="_blank" rel="noopener">nginx 的安装及配置</a></li>
<li><a href="https://www.qcloud.com/community/article/593436" target="_blank" rel="noopener">Nginx 网站服务器学习与入门</a></li>
<li><a href="http://blog.csdn.net/littlesmallless/article/details/59173287" target="_blank" rel="noopener">nginx 如何启用对 HTTP2 的支持</a></li>
<li><a href="http://bbs.qcloud.com/thread-10429-1-1.html" target="_blank" rel="noopener">CentOS 7 中 Nginx1.9.5 编译安装教程 systemctl 启动</a></li>
</ol>
<h3 id="安装-Git"><a href="#安装-Git" class="headerlink" title="安装 Git"></a>安装 Git</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 Git</span></span><br><span class="line">yum install git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Git 版本</span></span><br><span class="line">git --version</span><br></pre></td></tr></table></figure>
<h3 id="安装-Node-和-PM2"><a href="#安装-Node-和-PM2" class="headerlink" title="安装 Node 和 PM2"></a>安装 Node 和 PM2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 Node.js</span></span><br><span class="line">yum install nodejs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Node 版本</span></span><br><span class="line">node -v</span><br><span class="line"><span class="comment"># 查看 NPM 版本</span></span><br><span class="line">npm -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局安装 PM2</span></span><br><span class="line">npm i -g pm2</span><br></pre></td></tr></table></figure>
<h2 id="搭建-Blog"><a href="#搭建-Blog" class="headerlink" title="搭建 Blog"></a>搭建 Blog</h2><h3 id="部署-Node-服务器环境"><a href="#部署-Node-服务器环境" class="headerlink" title="部署 Node 服务器环境"></a>部署 Node 服务器环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我将博客放在了 /home 挂载点内</span></span><br><span class="line"><span class="comment"># 将 Node 静态服务模板克隆到 /home/blog 目录下</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/no-nothing/server.git /home/blog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到 blog 目录内</span></span><br><span class="line"><span class="built_in">cd</span> /home/blog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">npm i</span><br></pre></td></tr></table></figure>
<h3 id="部署-Blog-页面"><a href="#部署-Blog-页面" class="headerlink" title="部署 Blog 页面"></a>部署 Blog 页面</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 克隆自己的 Blog 页面到 /home/blog/public 目录下</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/no-nothing/no-nothing.github.io.git /home/blog/public</span><br></pre></td></tr></table></figure>
<p><strong>或者上传本地的 Blog 页面：</strong></p>
<p>先将本地的网页压缩成 zip 包（Centos 默认支持解压 zip 文件）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到 blog 目录内</span></span><br><span class="line"><span class="built_in">cd</span> /home/blog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传</span></span><br><span class="line">rz -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩包到 /home/blog/public 目录下</span></span><br><span class="line">unzip 压缩包名.zip -d /home/blog/public</span><br></pre></td></tr></table></figure>
<h3 id="启用-Node-服务"><a href="#启用-Node-服务" class="headerlink" title="启用 Node 服务"></a>启用 Node 服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到 blog 目录内</span></span><br><span class="line"><span class="built_in">cd</span> /home/blog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以 blog 为 PM2 进程名称</span></span><br><span class="line">pm2 start app.js --name blog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 pm2 启动的服务开机自启</span></span><br><span class="line">pm2 save</span><br><span class="line">pm2 startup</span><br></pre></td></tr></table></figure>
<p>现在可以通过 <em>IP 地址:3000</em> 访问刚才部署的 Blog 了。</p>
<h2 id="配置-Nginx（同时开启-https）"><a href="#配置-Nginx（同时开启-https）" class="headerlink" title="配置 Nginx（同时开启 https）"></a>配置 Nginx（同时开启 https）</h2><p><em>需要先完成域名解析</em></p>
<h3 id="获取证书"><a href="#获取证书" class="headerlink" title="获取证书"></a>获取证书</h3><ol>
<li>打开<a href="https://console.qcloud.com/ssl" target="_blank" rel="noopener">腾讯云-SSL 证书管理</a>，点击 <strong>申请证书</strong>，按提示一步步操作；</li>
<li>下载证书；</li>
<li>解压下载好的压缩包，选择符合自己服务环境的证书；</li>
</ol>
<h3 id="将证书上传至服务器"><a href="#将证书上传至服务器" class="headerlink" title="将证书上传至服务器"></a>将证书上传至服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我是通过 yum install nginx 安装的 nginx，所以 nginx 根目录在 /etc/nginx</span></span><br><span class="line"><span class="built_in">cd</span> /etc/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 ssl 文件夹存放证书</span></span><br><span class="line">mkdir ssl</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ssl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 lrzsz (Xshell环境下用于文件上传和下载)上传证书</span></span><br><span class="line">rz</span><br><span class="line"><span class="comment"># 选择 *.crt 和 *.key 两个文件</span></span><br></pre></td></tr></table></figure>
<h3 id="修改-nginx-配置文件"><a href="#修改-nginx-配置文件" class="headerlink" title="修改 nginx 配置文件"></a>修改 nginx 配置文件</h3><h4 id="1-从服务器取出-nginx-conf-文件"><a href="#1-从服务器取出-nginx-conf-文件" class="headerlink" title="1. 从服务器取出 nginx.conf 文件"></a>1. 从服务器取出 nginx.conf 文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx</span><br><span class="line"></span><br><span class="line">sz nginx.conf</span><br></pre></td></tr></table></figure>
<h4 id="2-修改-nginx-conf-文件"><a href="#2-修改-nginx-conf-文件" class="headerlink" title="2. 修改 nginx.conf 文件"></a>2. 修改 nginx.conf 文件</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定实际的服务器列表</span></span><br><span class="line"><span class="attribute">upstream</span> blog &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:3000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># http 请求重定向到 https</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  singple.com www.singple.com; <span class="comment">#换成你的域名</span></span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span>   https://www.singple.com<span class="variable">$request_uri</span>; <span class="comment">#这里的 www.singple.com 换成你的域名或者 $server_name</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># https 配置</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2 default_server;</span><br><span class="line">    <span class="attribute">server_name</span>  www.singple.com; <span class="comment">#换成你的域名</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl</span>                        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_certificate</span>            ssl/1_www.singple.com_bundle.crt; <span class="comment">#证书文件</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span>        ssl/2_www.singple.com.key; <span class="comment">#秘钥文件</span></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span>        <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_protocols</span>              TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span>                ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span>  <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>   http://blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">        <span class="attribute">location</span> = /40x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">        <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他的 URL 请求返回 501 （可选配置）</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span> default;</span><br><span class="line">    <span class="attribute">return</span>       <span class="number">501</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><strong>补充：</strong></p>
<p><a href="https://github.com/no-nothing/github-pages/blob/master/nginx/nginx.conf" target="_blank" rel="noopener">完整的 nginx.conf 文件</a></p>
<h4 id="3-上传修改后的-nginx-conf，并重新加载-nginx-配置"><a href="#3-上传修改后的-nginx-conf，并重新加载-nginx-配置" class="headerlink" title="3. 上传修改后的 nginx.conf，并重新加载 nginx 配置"></a>3. 上传修改后的 nginx.conf，并重新加载 nginx 配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 nginx.conf 后，上传</span></span><br><span class="line">rz -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启 nginx</span></span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启 nginx</span></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx.service</span><br></pre></td></tr></table></figure>
<h4 id="4-如果无法访问"><a href="#4-如果无法访问" class="headerlink" title="4. 如果无法访问"></a>4. 如果无法访问</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用https服务</span></span><br><span class="line">firewall-cmd --permanent --zone=public --add-service=https</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 443 端口(https)</span></span><br><span class="line">firewall-cmd --zone=public --add-port=443/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载防火墙，使新添的规则生效</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<p><strong>参考:</strong></p>
<ol>
<li><a href="https://www.qcloud.com/community/article/667588001491218602" target="_blank" rel="noopener">个人网站如何开启 HTTPS？</a></li>
<li><a href="https://www.bjornjohansen.no/redirect-to-https-with-nginx" target="_blank" rel="noopener">Redirect all HTTP requests to HTTPS with Nginx</a></li>
</ol>
<h2 id="开启防火墙"><a href="#开启防火墙" class="headerlink" title="开启防火墙"></a>开启防火墙</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">firewall-cmd --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若提示 command not found，安装 firewalld</span></span><br><span class="line">yum install firewalld firewall-config</span><br></pre></td></tr></table></figure>
<h3 id="开启-关闭指定端口"><a href="#开启-关闭指定端口" class="headerlink" title="开启/关闭指定端口"></a>开启/关闭指定端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 firewalld</span></span><br><span class="line">systemctl start firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 firewalld 状态</span></span><br><span class="line">firewall-cmd --state</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启 firewalld</span></span><br><span class="line">systemctl <span class="built_in">enable</span> firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># firewalld 默认会关闭所有端口访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 80 端口(此时只有 80 端口可以访问)</span></span><br><span class="line"><span class="comment"># --permanent 永久</span></span><br><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用https服务</span></span><br><span class="line">firewall-cmd --zone=public --add-service=https --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 443 端口(https)</span></span><br><span class="line">firewall-cmd --zone=public --add-port=443/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载防火墙，生效新添的规则</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 public 下开启的端口列表</span></span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure>
<h2 id="附录："><a href="#附录：" class="headerlink" title="附录："></a>附录：</h2><h3 id="Systemd-常用命令："><a href="#Systemd-常用命令：" class="headerlink" title="Systemd 常用命令："></a>Systemd 常用命令：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 立即激活单元</span></span><br><span class="line">systemctl start &lt;单元&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 立即停止单元：</span></span><br><span class="line">systemctl stop &lt;单元&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启单元：</span></span><br><span class="line">systemctl restart &lt;单元&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载配置：</span></span><br><span class="line">systemctl reload &lt;单元&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出单元运行状态：</span></span><br><span class="line">systemctl status &lt;单元&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查单元是否配置为自动启动：</span></span><br><span class="line">systemctl is-enabled &lt;单元&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自动激活单元：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> &lt;单元&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消开机自动激活单元：</span></span><br><span class="line">systemctl <span class="built_in">disable</span> &lt;单元&gt;</span><br></pre></td></tr></table></figure>
<p><strong>参考:</strong></p>
<ol>
<li><a href="https://wiki.archlinux.org/index.php/Systemd" target="_blank" rel="noopener">systemd-ArchWiki</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html" target="_blank" rel="noopener">Systemd 入门教程：命令篇</a></li>
</ol>
<h3 id="Nginx-常用命令："><a href="#Nginx-常用命令：" class="headerlink" title="Nginx 常用命令："></a>Nginx 常用命令：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx 启动</span></span><br><span class="line"><span class="comment"># 其中参数 -c 指定 nginx 启动时加载的配置文件，当然也可以不指定配置文件，省略 -c，也可以启动，表示使用默认的配置文件</span></span><br><span class="line">nginx -c /etc/nginx/nginx.conf</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx 停止</span></span><br><span class="line"><span class="comment"># 例如在我们的编辑环境中已经安装好了 nginx，并且已启动，在命令提示符下直接输入 nginx -s stop 就可以停止了</span></span><br><span class="line">nginx -s stop</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">nginx -s quit</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">pkill -9 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx 重载配置</span></span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查配置文件是否正确</span></span><br><span class="line">nginx -t</span><br></pre></td></tr></table></figure>
<p><strong>参考:</strong></p>
<ol>
<li><a href="https://wiki.archlinux.org/index.php/Systemd" target="_blank" rel="noopener">systemd-ArchWiki</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html" target="_blank" rel="noopener">Systemd 入门教程：命令篇</a></li>
</ol>
<h3 id="firewalld-常用命令："><a href="#firewalld-常用命令：" class="headerlink" title="firewalld 常用命令："></a>firewalld 常用命令：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">firewall-cmd --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 firewalld 状态</span></span><br><span class="line">firewall-cmd --state</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看开启的端口列表</span></span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 public 下开启的端口列表</span></span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 firewalld</span></span><br><span class="line">systemctl start firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启 firewalld</span></span><br><span class="line">systemctl restart firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启 firewalld</span></span><br><span class="line">systemctl <span class="built_in">enable</span> firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭开机自启 firewalld</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># firewalld 默认会关闭所有端口访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 80 端口(此时只有 80 端口可以访问)</span></span><br><span class="line"><span class="comment"># --permanent 永久</span></span><br><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用https服务</span></span><br><span class="line">firewall-cmd --permanent --zone=public --add-service=https</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 443 端口(https)</span></span><br><span class="line">firewall-cmd --zone=public --add-port=443/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载防火墙，生效新添的规则</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<p><strong>参考:</strong></p>
<ol>
<li><a href="http://www.cnblogs.com/phpshen/p/5842118.html" target="_blank" rel="noopener">centos7 firewall 防火墙 命令</a></li>
</ol>
<h3 id="PM2-常用命令："><a href="#PM2-常用命令：" class="headerlink" title="PM2 常用命令："></a>PM2 常用命令：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 启动</span></span><br><span class="line">pm2 start app.js</span><br><span class="line"><span class="comment"># 以 process-name 为 PM2 进程名称</span></span><br><span class="line">pm2 start app.js --name process-name</span><br><span class="line"><span class="comment"># 根据 CPU 核数启动进程个数</span></span><br><span class="line">pm2 start app.js -i 0</span><br><span class="line"><span class="comment"># 实时监控 app.js 的方式启动，当 app.js 文件有变动时，PM2 会自动reload</span></span><br><span class="line">pm2 start app.js --watch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 查看进程</span></span><br><span class="line">pm2 list</span><br><span class="line"><span class="comment"># 查看进程详细信息，0 为 PM2 进程 id</span></span><br><span class="line">pm2 show 0</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">pm2 info 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 监控</span></span><br><span class="line">pm2 monit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 停止</span></span><br><span class="line"><span class="comment"># 停止 PM2 列表中所有的进程</span></span><br><span class="line">pm2 stop all</span><br><span class="line"><span class="comment"># 停止 PM2 列表中进程为 0 的进程</span></span><br><span class="line">pm2 stop 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 重载</span></span><br><span class="line"><span class="comment"># 重载 PM2 列表中所有的进程</span></span><br><span class="line">pm2 reload all</span><br><span class="line"><span class="comment"># 重载 PM2 列表中进程为 0 的进程</span></span><br><span class="line">pm2 reload 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 重启</span></span><br><span class="line"><span class="comment"># 重启 PM2 列表中所有的进程</span></span><br><span class="line">pm2 restart all</span><br><span class="line"><span class="comment"># 重启 PM2 列表中进程为 0 的进程</span></span><br><span class="line">pm2 restart 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 删除 PM2 进程</span></span><br><span class="line"><span class="comment"># 删除 PM2 列表中所有的进程</span></span><br><span class="line">pm2 delete all</span><br><span class="line"><span class="comment"># 删除 PM2 列表中进程为 0 的进程</span></span><br><span class="line">pm2 delete 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. 日志操作</span></span><br><span class="line"><span class="comment"># 显示所有进程日志</span></span><br><span class="line">pm2 logs</span><br><span class="line"><span class="comment"># 清除所有日志</span></span><br><span class="line">pm2 flush</span><br><span class="line"><span class="comment"># 重载所有日志</span></span><br><span class="line">pm2 reloadLogs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9. 升级 PM2</span></span><br><span class="line"><span class="comment"># 安装最新的 PM2 版本</span></span><br><span class="line">npm install pm2@lastest -g</span><br><span class="line"><span class="comment"># 升级 PM2</span></span><br><span class="line">pm2 updatePM2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10. 更多命令参数请查看帮助</span></span><br><span class="line">pm2 --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>
<p><strong>参考：</strong></p>
<ol>
<li><a href="http://pm2.keymetrics.io/" target="_blank" rel="noopener">PM2 官网</a></li>
<li><a href="http://www.yedanbo.com/post/2017/qcloud-deploy-nodejs-application/" target="_blank" rel="noopener">腾讯云服务器部署 Node.js 应用</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zh-rocco.github.io/a-linux/server.html" data-id="cjnvxci7t003wpau6bjovdryx" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/firewall/">firewall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/https/">https</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lrzsz/">lrzsz</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openssl/">openssl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pm2/">pm2</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/systemctl/">systemctl</a></li></ul>


    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/a-linux/pause.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          说明（2017-05-28）
        
      </div>
    </a>
  
  
    <a href="/a-css/snippet.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">常用 CSS 片段</div>
    </a>
  
</nav>


  
</article>



</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Angular/">Angular</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Common/">Common</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node/">Node</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PWA/">PWA</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WeiXin/">WeiXin</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/apply/" style="font-size: 10px;">apply</a> <a href="/tags/array/" style="font-size: 10px;">array</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/bind/" style="font-size: 10px;">bind</a> <a href="/tags/bookmark/" style="font-size: 10px;">bookmark</a> <a href="/tags/cache/" style="font-size: 10px;">cache</a> <a href="/tags/call/" style="font-size: 10px;">call</a> <a href="/tags/cross-origin/" style="font-size: 10px;">cross-origin</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/experience/" style="font-size: 10px;">experience</a> <a href="/tags/fetch/" style="font-size: 10px;">fetch</a> <a href="/tags/firewall/" style="font-size: 10px;">firewall</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/lrzsz/" style="font-size: 10px;">lrzsz</a> <a href="/tags/manifest/" style="font-size: 10px;">manifest</a> <a href="/tags/move/" style="font-size: 10px;">move</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/openssl/" style="font-size: 10px;">openssl</a> <a href="/tags/performance/" style="font-size: 10px;">performance</a> <a href="/tags/pm2/" style="font-size: 10px;">pm2</a> <a href="/tags/pwa/" style="font-size: 20px;">pwa</a> <a href="/tags/regex/" style="font-size: 10px;">regex</a> <a href="/tags/service-worker/" style="font-size: 10px;">service worker</a> <a href="/tags/systemctl/" style="font-size: 10px;">systemctl</a> <a href="/tags/webstorm/" style="font-size: 10px;">webstorm</a> <a href="/tags/window/" style="font-size: 10px;">window</a> <a href="/tags/yarn/" style="font-size: 10px;">yarn</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/a-common/move.html">博客迁移</a>
          </li>
        
          <li>
            <a href="/a-js/caches.html">Cache API</a>
          </li>
        
          <li>
            <a href="/a-js/fetch.html">Fetch API</a>
          </li>
        
          <li>
            <a href="/a-pwa/manifest.html">应用清单 - PWA</a>
          </li>
        
          <li>
            <a href="/a-common/bookmark.html">书签</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    <div class="widget-wrap">
  <h3 class="widget-title">友情链接</h3>
  <div class="widget">
    <ul>
      
      <li>
        <a href="http://www.yedanbo.com/" target="_blank" rel="nofollow me noopener noreferrer">叶丹波</a>
      </li>
      
      <li>
        <a href="https://kongwz.github.io/" target="_blank" rel="nofollow me noopener noreferrer">Kelo</a>
      </li>
      
      <li>
        <a href="https://colorfulWorld.github.io/" target="_blank" rel="nofollow me noopener noreferrer">Eternal</a>
      </li>
      
    </ul>
  </div>
</div>

  
</aside>

        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018
      <a href="https://github.com/zh-rocco" target="_blank" rel="nofollow me noopener noreferrer">Rocco</a>
      <br>
      Powered by <a href="http://hexo.io/" target="_blank" rel="nofollow me noopener noreferrer">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>

    

<!-- <script src="https://cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script> -->

<script src="/jquery/jquery-3.3.1.min.js"></script>



<script src="/js/script.js"></script>

  </div>

  
</body>
</html>
