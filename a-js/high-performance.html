<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
  <meta name="format-detection" content="telephone=no, email=no">
  <meta name="baidu-site-verification" content="1mIt1OtUw3" />

  

  
  <link rel="alternate" href="/atom.xml" title="Rocco&#39;s Blog" type="application/atom+xml">
  

  <!-- 为 IOS 上的 Safari 添加桌面图标 -->
  <meta name="apple-mobile-web-app-title" content="Simple">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="#333">
  <link rel="apple-touch-icon-precomposed" sizes="128x128" href="/images/icons/icon-128.png">

  <!-- 为 Windows 添加磁片图标 -->
  <meta name="msapplication-TileImage" content="/images/icons/icon-128.png">
  <meta name="msapplication-TileColor" content="#ff0000">

  <meta name="baidu-site-verification" content="MHqWnI2vxk">

  
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
  
  <title>JavaScript 性能优化 | Rocco&#39;s Blog</title>
  <meta name="description" content="JavaScript, ES6, CSS3, 前端笔记">

  <link rel="stylesheet" href="/css/style.css">

  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f5f5f5">
</head>


<body>
  <div class="share-avatar">
    <img class="avatar" src="/images/avatar.jpg" alt="头像">
  </div>

  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner" class="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Rocco&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">简简简简单</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
      </nav>
      <nav id="sub-nav">
        
          <!--<a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>-->
        
        <a id="nav-github-btn" class="nav-icon" title="GitHub" href="https://github.com/zh-rocco" target="_blank" rel="nofollow me noopener noreferrer"></a>
        <!--<a id="nav-search-btn" class="nav-icon" title="搜索"></a>-->
      </nav>
      <!--<div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://zh-rocco.github.io"></form>
      </div>-->
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-a-js/high-performance" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a-js/high-performance.html" class="article-date">
  <time datetime="2017-05-02T03:50:00.000Z" itemprop="datePublished">2017-05-02</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>


  </div>
  <div class="article-inner">
    

    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      JavaScript 性能优化
    </h1>
  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-避免全局查找"><a href="#1-避免全局查找" class="headerlink" title="1. 避免全局查找"></a>1. 避免全局查找</h3><p>在一个函数中会用到全局对象存储为局部变量来减少全局查找，因为访问局部变量的速度要比访问全局变量的速度更快些</p>
<a id="more"></a>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当我要使用当前页面地址和主机域名</span></span><br><span class="line">  alert(<span class="built_in">window</span>.location.href + <span class="built_in">window</span>.location.host);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最好的方式是如下这样，先用一个简单变量保存起来</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> location = <span class="built_in">window</span>.location;</span><br><span class="line">  alert(location.href + location.host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-字符串连接"><a href="#2-字符串连接" class="headerlink" title="2. 字符串连接"></a>2. 字符串连接</h3><p>在一个函数中会用到全局对象存储为局部变量来减少全局查找，因为访问局部变量的速度要比访问全局变量的速度更快些</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line"><span class="comment">// 如果要连接多个字符串，应该少使用 +=，如</span></span><br><span class="line">s += a;</span><br><span class="line">s += b;</span><br><span class="line">s += c;</span><br><span class="line"></span><br><span class="line"><span class="comment">//应该写成：</span></span><br><span class="line">s += a + b + c;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2 */</span></span><br><span class="line"><span class="comment">// 而如果是收集字符串，比如多次对同一个字符串进行 += 操作的话，最好使用一个缓存，使用 JavaScript 数组来收集，最后使用 join 方法连接起来</span></span><br><span class="line"><span class="keyword">var</span> buf = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">  buf.push(i.toString());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> all = buf.join(<span class="string">''</span>);</span><br></pre></td></tr></table></figure>
<h3 id="3-避免-with-语句"><a href="#3-避免-with-语句" class="headerlink" title="3. 避免 with 语句"></a>3. 避免 with 语句</h3><p>和函数类似，with 语句会创建自己的作用域，因此会增加其中执行的代码的作用域链的长度，由于额外的作用域链的查找，在 with 语句中执行的代码肯定会比外面执行的代码要慢，<strong>在能不使用 with 语句的时候尽量不要使用 with 语句。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> (a.b.c.d) &#123;</span><br><span class="line">  property1 = <span class="number">1</span>;</span><br><span class="line">  property2 = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以替换为：</span></span><br><span class="line"><span class="keyword">var</span> obj = a.b.c.d;</span><br><span class="line">obj.property1 = <span class="number">1</span>;</span><br><span class="line">obj.property2 = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<h3 id="4-数字转换成字符串、浮点数转换成整型"><a href="#4-数字转换成字符串、浮点数转换成整型" class="headerlink" title="4. 数字转换成字符串、浮点数转换成整型"></a>4. 数字转换成字符串、浮点数转换成整型</h3><ul>
<li>最好用 <code>&quot;&quot; + num</code> 来将数字转换成字符串，虽然看起来比较丑一点，但事实上这个效率是最高的，性能上来说：(“” + num) &gt; String() &gt; .toString() &gt; new String()</li>
<li>很多人喜欢使用 parseInt()，其实 parseInt() 是用于将字符串转换成数字，而不是浮点数和整型之间的转换，我们应该使用 Math.floor() 或者 Math.round()</li>
</ul>
<h3 id="5-使用直接量"><a href="#5-使用直接量" class="headerlink" title="5. 使用直接量"></a>5. 使用直接量</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不要 var aTest = new Array(); //替换为：</span></span><br><span class="line"><span class="keyword">var</span> aTest = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不要 var aTest = new Object(); //替换为：</span></span><br><span class="line"><span class="keyword">var</span> aTest = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不要 var reg = new RegExp(); //替换为：</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/../</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果要创建具有一些特性的一般对象，也可以使用字面量，如下：</span></span><br><span class="line"><span class="keyword">var</span> oFruit = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">oFruit.color = <span class="string">'red'</span>;</span><br><span class="line">oFruit.name = <span class="string">'apple'</span>;</span><br><span class="line"><span class="comment">// 前面的代码可用对象字面量来改写成这样：</span></span><br><span class="line"><span class="keyword">var</span> oFruit = &#123; <span class="attr">color</span>: <span class="string">'red'</span>, <span class="attr">name</span>: <span class="string">'apple'</span> &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="6-使用-DocumentFragment-优化多次-append"><a href="#6-使用-DocumentFragment-优化多次-append" class="headerlink" title="6. 使用 DocumentFragment 优化多次 append"></a>6. 使用 DocumentFragment 优化多次 append</h3><p>一旦需要更新 DOM，请考虑使用文档碎片来构建 DOM 结构，然后再将其添加到现存的文档中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span><br><span class="line">  el.innerHTML = i;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(el);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可以替换为：</span></span><br><span class="line"><span class="keyword">var</span> frag = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span><br><span class="line">  el.innerHTML = i;</span><br><span class="line">  frag.appendChild(el);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frag);</span><br></pre></td></tr></table></figure>
<h3 id="7-使用一次-innerHTML-赋值代替构建-DOM-元素"><a href="#7-使用一次-innerHTML-赋值代替构建-DOM-元素" class="headerlink" title="7. 使用一次 innerHTML 赋值代替构建 DOM 元素"></a>7. 使用一次 innerHTML 赋值代替构建 DOM 元素</h3><p>对于大的 DOM 更改，使用 innerHTML 要比使用标准的 DOM 方法创建同样的 DOM 结构更快，但差别并不大。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> frag = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span><br><span class="line">  el.innerHTML = i;</span><br><span class="line">  frag.appendChild(el);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frag);</span><br><span class="line"><span class="comment">// 可以替换为：</span></span><br><span class="line"><span class="keyword">var</span> html = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  html.push(<span class="string">'&lt;p&gt;'</span> + i + <span class="string">'&lt;/p&gt;'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.body.innerHTML = html.join(<span class="string">''</span>);</span><br></pre></td></tr></table></figure>
<h3 id="8-通过模板元素-clone-替代-createElement"><a href="#8-通过模板元素-clone-替代-createElement" class="headerlink" title="8. 通过模板元素 clone 替代 createElement"></a>8. 通过模板元素 clone 替代 createElement</h3><p>使用 <code>cloneNode()</code> 可以减少属性的设置次数——同样如果需要创建很多元素，应该先准备一个样板节点。大多数浏览器中，克隆节点更有效率，但提高不多</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> frag = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span><br><span class="line">  el.innerHTML = i;</span><br><span class="line">  frag.appendChild(el);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frag);</span><br><span class="line"><span class="comment">// 替换为：</span></span><br><span class="line"><span class="keyword">var</span> frag = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line"><span class="keyword">var</span> pEl = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'p'</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> el = pEl.cloneNode(<span class="literal">false</span>);</span><br><span class="line">  el.innerHTML = i;</span><br><span class="line">  frag.appendChild(el);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frag);</span><br></pre></td></tr></table></figure>
<h3 id="9-使用-firstChild-和-nextSibling-代替-childNodes-遍历-DOM-元素"><a href="#9-使用-firstChild-和-nextSibling-代替-childNodes-遍历-DOM-元素" class="headerlink" title="9. 使用 firstChild 和 nextSibling 代替 childNodes 遍历 DOM 元素"></a>9. 使用 firstChild 和 nextSibling 代替 childNodes 遍历 DOM 元素</h3><p>老 IE 中，nextSibling 的效率更高，其他情况下，没太多差别</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nodes = element.childNodes;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = nodes.length; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> node = nodes[i];</span><br><span class="line">    <span class="comment">//……</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可以替换为：</span></span><br><span class="line"><span class="keyword">var</span> node = element.firstChild;</span><br><span class="line"><span class="keyword">while</span> (node) &#123;</span><br><span class="line">    <span class="comment">//……</span></span><br><span class="line">    node = node.nextSibling;</span><br></pre></td></tr></table></figure>
<h3 id="10-删除-DOM-节点、使用事件代理"><a href="#10-删除-DOM-节点、使用事件代理" class="headerlink" title="10. 删除 DOM 节点、使用事件代理"></a>10. 删除 DOM 节点、使用事件代理</h3><ul>
<li>删除 DOM 节点之前，一定要删除注册在该节点上的事件, 否则将会产生无法回收的内存。另外，在 removeChild 和 <code>innerHTML = &#39;&#39;</code> 二者之间，尽量选择后者。因为在 sIEve(内存泄露监测工具)中监测的结果是用 <code>removeChild</code> 无法有效地释放 DOM 节点。</li>
<li>对于内容动态增加并且子节点都需要相同的事件处理函数的情况，可以把事件注册提到父节点上，这样就不需要为每个子节点注册事件监听了（事件代理）。</li>
</ul>
<h3 id="11-重复使用的调用结果，事先保存到局部变量"><a href="#11-重复使用的调用结果，事先保存到局部变量" class="headerlink" title="11. 重复使用的调用结果，事先保存到局部变量"></a>11. 重复使用的调用结果，事先保存到局部变量</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 避免多次取值的调用开销</span></span><br><span class="line"><span class="keyword">var</span> h1 = element1.clientHeight + num1;</span><br><span class="line"><span class="keyword">var</span> h2 = element1.clientHeight + num2;</span><br><span class="line"><span class="comment">// 可以替换为：</span></span><br><span class="line"><span class="keyword">var</span> eleHeight = element1.clientHeight;</span><br><span class="line"><span class="keyword">var</span> h1 = eleHeight + num1;</span><br><span class="line"><span class="keyword">var</span> h2 = eleHeight + num2;</span><br></pre></td></tr></table></figure>
<h3 id="12-循环优化"><a href="#12-循环优化" class="headerlink" title="12. 循环优化"></a>12. 循环优化</h3><ul>
<li>减值迭代：大多数循环使用一个从 0 开始、增加到某个特定值的迭代器，在很多情况下，从最大值开始，在循环中不断减值的迭代器更加高效；</li>
<li>简化终止条件：避免属性查找或者其它的操作，最好是将循环控制量保存到局部变量中；</li>
<li>简化循环体：循环体是执行最多的，所以要确保其被最大限度的优化；</li>
<li>使用后测试循环：循环中 <code>for(var elem in ...)</code> 的效率极差，尽量少用。while 循环的效率要优于 for 循环，for 循环和 while 循环都是前测试循环，而如 do-while 这种后测试循环，可以避免最初终止条件的计算，因此运行更快；</li>
<li>使用查表法替代循环：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> results = [result0, result1, result2, result3, result4, result5, result6, result7, result8, result9, result10];</span><br><span class="line"><span class="keyword">return</span> results[value];</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="13-避免双重解释"><a href="#13-避免双重解释" class="headerlink" title="13. 避免双重解释"></a>13. 避免双重解释</h3><ul>
<li>尽量少使用 eval 函数：使用 eval 相当于在运行时再次调用解释引擎对内容进行运行，需要消耗大量时间，而且使用 eval 带来的安全性问题也是不容忽视的。</li>
<li>不要使用 Function 构造器：不要给 setTimeout 或者 setInterval 传递字符串参数。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">0</span>;</span><br><span class="line">setTimeout(<span class="string">'num++'</span>, <span class="number">10</span>);</span><br><span class="line"><span class="comment">// 可以替换为：</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addNum</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  num++;</span><br><span class="line">&#125;</span><br><span class="line">setTimeout(addNum, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="14-缩短否定检测"><a href="#14-缩短否定检测" class="headerlink" title="14. 缩短否定检测"></a>14. 缩短否定检测</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (oTest != <span class="string">'#ff0000'</span>) &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (oTest != <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (oTest != <span class="literal">false</span>) &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 虽然这些都正确，但用逻辑非操作符来操作也有同样的效果：</span></span><br><span class="line"><span class="keyword">if</span> (!oTest) &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="15-条件分支"><a href="#15-条件分支" class="headerlink" title="15. 条件分支"></a>15. 条件分支</h3><ul>
<li>将条件分支，按可能性顺序从高到低排列：可以减少解释器对条件的探测次数；</li>
<li>条件分支多(&gt;2)时，使用 switch 优于 if：switch 分支选择的效率高于 if，在 IE 下尤为明显。4 分支的测试，IE 下 switch 的执行时间约为 if 的一半；</li>
<li>使用三目运算符替代条件分支：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a &gt; b) &#123;</span><br><span class="line">  num = a;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  num = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//可以替换为：</span></span><br><span class="line">num = a &gt; b ? a : b;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="16-使用常量"><a href="#16-使用常量" class="headerlink" title="16. 使用常量"></a>16. 使用常量</h3><ul>
<li>重复值：任何在多处用到的值都应该抽取为一个常量；</li>
<li>用户界面字符串：任何用于显示给用户的字符串，都应该抽取出来以方便国际化；</li>
<li>URLs：在 Web 应用中，资源位置很容易变更，所以推荐用一个公共地方存放所有的 URL；</li>
<li>任意可能会更改的值：每当你用到字面量值的时候，你都要问一下自己这个值在未来是不是会变化，如果答案是“是”，那么这个值就应该被提取出来作为一个常量。</li>
</ul>
<h3 id="17-避免与-null-进行比较"><a href="#17-避免与-null-进行比较" class="headerlink" title="17. 避免与 null 进行比较"></a>17. 避免与 null 进行比较</h3><ul>
<li>如果值应为一个引用类型，使用 instanceof 操作符检查其构造函数；</li>
<li>如果值应为一个引用类型，使用 typeof 检查其类型；</li>
<li>如果是希望对象包含某个特定的方法名，则使用 typeof 操作符确保指定名字的方法存在于对象上。</li>
</ul>
<h3 id="18-避免全局变量"><a href="#18-避免全局变量" class="headerlink" title="18. 避免全局变量"></a>18. 避免全局变量</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">myNameSpace = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> current = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">verify</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 所有需要在命名空间外调用的函数和属性都要写在return里面</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    init: init,</span><br><span class="line">    <span class="comment">// 甚至你可以为函数和属性命名一个别名</span></span><br><span class="line">    set: change</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="19-循环引用"><a href="#19-循环引用" class="headerlink" title="19. 循环引用"></a>19. 循环引用</h3><p>如果循环引用中包含 DOM 对象或者 ActiveX 对象，那么就会发生内存泄露。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'MyElement'</span>);</span><br><span class="line">  el.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//……</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">init();</span><br></pre></td></tr></table></figure>
<p><code>init</code> 在执行的时候，当前上下文我们叫做 <code>context</code>。这个时候，<code>context</code> 引用了 <code>el</code>，<code>el</code> 引用了 <code>function</code>，<code>function</code> 引用了 <code>context</code>；这时候形成了一个循环引用。</p>
<p><strong>解决方案：</strong></p>
<ul>
<li>置空 DOM 对象：将 <code>el</code> 置空，<code>context</code> 中不包含对 DOM 对象的引用，从而打断循环应用：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'MyElement'</span>);</span><br><span class="line">  el.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//……</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    el = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">init();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>构造新的 context：把 function 抽到新的 context 中，这样，function 的 context 就不包含对 el 的引用，从而打断循环引用：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">elClickHandler</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//……</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'MyElement'</span>);</span><br><span class="line">  el.onclick = elClickHandler;</span><br><span class="line">&#125;</span><br><span class="line">init();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="20-释放-DOM-元素占用的内存、释放-JavaScript-对象"><a href="#20-释放-DOM-元素占用的内存、释放-JavaScript-对象" class="headerlink" title="20. 释放 DOM 元素占用的内存、释放 JavaScript 对象"></a>20. 释放 DOM 元素占用的内存、释放 JavaScript 对象</h3><ul>
<li>将 DOM 元素的 <code>innerHTML</code> 设置为空字符串，可以释放其子元素占用的内存；</li>
<li>及时释放对对象的引用，让 GC 能够回收这些内存控件；</li>
<li>对象：<code>obj = null</code>；</li>
<li>对象属性：<code>delete obj.myproperty</code>；</li>
<li>数组 item：使用数组的 splice 方法释放数组中不用的 item；</li>
</ul>
<h3 id="21-松散耦合"><a href="#21-松散耦合" class="headerlink" title="21. 松散耦合"></a>21. 松散耦合</h3><ul>
<li>JavaScript 和 HTML 的紧密耦合：直接写在 HTML 中的 JavaScript、使用包含内联代码的 <code>&lt;script&gt;</code> 元素、使用 HTML 属性来分配事件处理程序等；</li>
<li>HTML 和 JavaScript 的紧密耦合：JavaScript 中包含 HTML，然后使用 innerHTML 来插入一段 HTML 文本到页面；</li>
<li>解耦 CSS/JavaScript<br>显示问题的唯一来源应该是 CSS，行为问题的唯一来源应该是 JavaScript，层次之间保持松散耦合才可以让你的应用程序更加易于维护，所以像以下的代码 <code>element.style.color = &quot;red&quot;</code> 尽量改为 <code>element.className = &quot;edit&quot;</code>，而且不要在 JavaScript 中通过表达式嵌入 CSS；</li>
<li>解耦应用程序/事件处理程序将应用逻辑和事件处理程序相分离：<strong>一个事件处理程序应该从事件对象中提取</strong>，并将这些信息传送给处理应用逻辑的某个方法中。这样做的好处首先可以让你更容易更改触发特定过程的事件，其次可以在不附加事件的情况下测试代码，使其更易创建单元测试；</li>
</ul>
<h3 id="22-和-的区别"><a href="#22-和-的区别" class="headerlink" title="22. == 和 === 的区别"></a>22. == 和 === 的区别</h3><p><code>==</code> 和 <code>!=</code> 操作符会进行类型强制转换。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> valueA = <span class="string">'1'</span>;</span><br><span class="line"><span class="keyword">var</span> valueB = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (valueA == valueB) &#123;</span><br><span class="line">  alert(<span class="string">'Equal'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  alert(<span class="string">'Not equal'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output: "Equal"</span></span><br><span class="line"><span class="keyword">if</span> (valueA === valueB) &#123;</span><br><span class="line">  alert(<span class="string">'Equal'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  alert(<span class="string">'Not equal'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output: "Not equal"</span></span><br></pre></td></tr></table></figure>
<h3 id="23-何时用单引号，何时用双引号"><a href="#23-何时用单引号，何时用双引号" class="headerlink" title="23. 何时用单引号，何时用双引号"></a>23. 何时用单引号，何时用双引号</h3><p>虽然在 JavaScript 当中，双引号和单引号都可以表示字符串, 为了避免混乱，建议在 HTML 中使用双引号，在 JavaScript 中使用单引号，但为了兼容各个浏览器，也为了解析时不会出错，定义 JSON 对象时，最好使用双引号。</p>
<h3 id="24-函数返回统一类型"><a href="#24-函数返回统一类型" class="headerlink" title="24. 函数返回统一类型"></a>24. 函数返回统一类型</h3><p>JavaScript 是弱类型的，对于函数来说，前面返回整数型数据，后面返回布尔值在编译和运行都可以正常通过，但为了规范和以后维护时容易理解，应保证函数应返回统一的数据类型。</p>
<h3 id="25-浏览器-UI-线程"><a href="#25-浏览器-UI-线程" class="headerlink" title="25. 浏览器 UI 线程"></a>25. 浏览器 UI 线程</h3><ul>
<li>每个时刻只有其中的一个操作得以执行，也就是 JavaScript 代码运行时用户界面不能对输入产生反应，反之亦然。管理好 JS 运行时间对网页应用的性能很重要；</li>
<li>一个单一的 JS 操作应当使用的总时间（最大）是 100 毫秒，如果有些 JS 任务因为复杂性原因不能在 100 毫秒或更少的时间内完成，这种情况下，理想方法是让出对 UI 线程的控制，让 UI 更新可以进行，用定时器让出时间片；</li>
<li>定时器小于 15 将在 IE 中导致浏览器锁定，所以最小值建议为 25 毫秒；</li>
<li>低频率的重复定时器（间隔在 1 秒或 1 秒以上），几乎不影响整个网页应用的响应；</li>
<li>多个重复定时器使用更高的频率（间隔在 100 到 200 毫秒之间）性能更低，最好合并成一个单独的重复定时器，每次执行多个操作。</li>
</ul>
<h3 id="25-性能方面的注意事项"><a href="#25-性能方面的注意事项" class="headerlink" title="25. 性能方面的注意事项"></a>25. 性能方面的注意事项</h3><ul>
<li>尽量使用原生方法；</li>
<li>switch 语句相对 if 较快，通过将 case 语句按照最可能到最不可能的顺序进行组织；</li>
<li>巧用 <code>||</code> 和 <code>&amp;&amp;</code> 布尔运算符；<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventHandler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!e) e = <span class="built_in">window</span>.event;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可以替换为：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventHandler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  e = e || <span class="built_in">window</span>.event;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zh-rocco.github.io/a-js/high-performance.html" data-id="cjnvx9yes003tlxu6fnmrhh6p" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/performance/">performance</a></li></ul>


    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/a-html/meta.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          meta 标签设置
        
      </div>
    </a>
  
  
    <a href="/a-js/mobile-click-300ms.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">解决移动端 300ms 延迟</div>
    </a>
  
</nav>


  
</article>



</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Angular/">Angular</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Common/">Common</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node/">Node</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PWA/">PWA</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WeiXin/">WeiXin</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/apply/" style="font-size: 10px;">apply</a> <a href="/tags/array/" style="font-size: 10px;">array</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/bind/" style="font-size: 10px;">bind</a> <a href="/tags/bookmark/" style="font-size: 10px;">bookmark</a> <a href="/tags/cache/" style="font-size: 10px;">cache</a> <a href="/tags/call/" style="font-size: 10px;">call</a> <a href="/tags/cross-origin/" style="font-size: 10px;">cross-origin</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/experience/" style="font-size: 10px;">experience</a> <a href="/tags/fetch/" style="font-size: 10px;">fetch</a> <a href="/tags/firewall/" style="font-size: 10px;">firewall</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/lrzsz/" style="font-size: 10px;">lrzsz</a> <a href="/tags/manifest/" style="font-size: 10px;">manifest</a> <a href="/tags/move/" style="font-size: 10px;">move</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/openssl/" style="font-size: 10px;">openssl</a> <a href="/tags/performance/" style="font-size: 10px;">performance</a> <a href="/tags/pm2/" style="font-size: 10px;">pm2</a> <a href="/tags/pwa/" style="font-size: 20px;">pwa</a> <a href="/tags/regex/" style="font-size: 10px;">regex</a> <a href="/tags/service-worker/" style="font-size: 10px;">service worker</a> <a href="/tags/systemctl/" style="font-size: 10px;">systemctl</a> <a href="/tags/webstorm/" style="font-size: 10px;">webstorm</a> <a href="/tags/window/" style="font-size: 10px;">window</a> <a href="/tags/yarn/" style="font-size: 10px;">yarn</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/a-common/move.html">博客迁移</a>
          </li>
        
          <li>
            <a href="/a-js/caches.html">Cache API</a>
          </li>
        
          <li>
            <a href="/a-js/fetch.html">Fetch API</a>
          </li>
        
          <li>
            <a href="/a-pwa/manifest.html">应用清单 - PWA</a>
          </li>
        
          <li>
            <a href="/a-common/bookmark.html">书签</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    <div class="widget-wrap">
  <h3 class="widget-title">友情链接</h3>
  <div class="widget">
    <ul>
      
      <li>
        <a href="http://www.yedanbo.com/" target="_blank" rel="nofollow me noopener noreferrer">叶丹波</a>
      </li>
      
      <li>
        <a href="https://kongwz.github.io/" target="_blank" rel="nofollow me noopener noreferrer">Kelo</a>
      </li>
      
      <li>
        <a href="https://colorfulWorld.github.io/" target="_blank" rel="nofollow me noopener noreferrer">Eternal</a>
      </li>
      
    </ul>
  </div>
</div>

  
</aside>

        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018
      <a href="https://github.com/zh-rocco" target="_blank" rel="nofollow me noopener noreferrer">Rocco</a>
      <br>
      Powered by <a href="http://hexo.io/" target="_blank" rel="nofollow me noopener noreferrer">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>

    

<!-- <script src="https://cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script> -->

<script src="/jquery/jquery-3.3.1.min.js"></script>



<script src="/js/script.js"></script>

  </div>

  
</body>
</html>
